{% extends "base-eco.html" %}

{% block content %}
<!-- Hero Section -->
<section class="eco-hero" style="min-height: 50vh; margin-top: 80px;">
    <div class="hero-content">
        <h1 class="hero-title" data-animate="fade-up">
            <i class="fas fa-user-circle eco-leaf"></i>
            My Profile
        </h1>
        <p class="hero-subtitle" data-animate="fade-up">
            Track your eco journey and achievements
        </p>
    </div>
</section>

<!-- Profile Content -->
<section class="section">
    <div class="container">
        <div class="profile-grid">
            <!-- Profile Card -->
            <div class="profile-main eco-card" data-animate="fade-right">
                <div class="profile-header">
                    <div class="profile-avatar">
                        <i class="fas fa-user-circle"></i>
                    </div>
                    <div class="profile-info">
                        <h2>{{ current_user.username }}</h2>
                        <p>{{ current_user.email }}</p>
                        <div class="member-since">
                            <i class="fas fa-calendar-alt"></i>
                            Member since {{ current_user.join_date.strftime('%B %d, %Y') }}
                        </div>
                    </div>
                </div>

                <div class="profile-stats-grid">
                    <div class="stat-box primary">
                        <div class="stat-icon">
                            <i class="fas fa-coins"></i>
                        </div>
                        <div class="stat-value" data-counter="{{ current_user.eco_points }}">0</div>
                        <div class="stat-label">Eco Points</div>
                    </div>

                    <div class="stat-box warning">
                        <div class="stat-icon">
                            <i class="fas fa-fire"></i>
                        </div>
                        <div class="stat-value" data-counter="{{ current_user.recycling_streak }}">0</div>
                        <div class="stat-label">Day Streak</div>
                    </div>
                </div>

                <div class="profile-actions">
                    <a href="{{ url_for('footprint_dashboard') }}" class="eco-btn w-100">
                        <i class="fas fa-chart-line"></i>
                        View Impact Dashboard
                        {% if current_user.badge_level %}
                        <span class="badge-level">{{ current_user.badge_level }}</span>
                        {% endif %}
                    </a>
                </div>
            </div>

            <!-- Stats Card -->
            <div class="profile-stats eco-card" data-animate="fade-left">
                <h3>
                    <i class="fas fa-chart-bar"></i>
                    My Statistics
                </h3>

                <div class="stats-list">
                    <div class="stat-item">
                        <span class="stat-label">
                            <i class="fas fa-search"></i>
                            Items Analyzed
                        </span>
                        <span class="stat-number" data-counter="{{ stats.total_items }}">0</span>
                    </div>

                    <div class="stat-item">
                        <span class="stat-label">
                            <i class="fas fa-recycle"></i>
                            Recyclable Items
                        </span>
                        <span class="stat-number success" data-counter="{{ stats.recyclable_items }}">0</span>
                    </div>

                    <div class="stat-item">
                        <span class="stat-label">
                            <i class="fas fa-laptop"></i>
                            E-Waste Items
                        </span>
                        <span class="stat-number warning" data-counter="{{ stats.ewaste_items }}">0</span>
                    </div>

                    <div class="stat-item">
                        <span class="stat-label">
                            <i class="fas fa-store"></i>
                            Marketplace Listings
                        </span>
                        <span class="stat-number info" data-counter="{{ stats.listed_items }}">0</span>
                    </div>

                    <div class="stat-item">
                        <span class="stat-label">
                            <i class="fas fa-trophy"></i>
                            Achievements
                        </span>
                        <span class="stat-number primary" data-counter="{{ stats.achievement_count }}">0</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Environmental Impact -->
        <div class="impact-showcase eco-card" data-animate="fade-up">
            <h2 class="text-center mb-5">
                <i class="fas fa-globe-americas"></i>
                Your Environmental Impact
            </h2>

            <div class="impact-metrics">
                <div class="impact-metric">
                    <div class="metric-icon">
                        <i class="fas fa-tree"></i>
                    </div>
                    <div class="metric-value">
                        <span class="number" data-counter="{{ stats.trees_saved|default(23) }}">0</span>
                    </div>
                    <div class="metric-label">Trees Equivalent</div>
                    <div class="metric-progress">
                        <div class="eco-progress">
                            <div class="eco-progress-bar" style="width: 65%;"></div>
                        </div>
                    </div>
                </div>

                <div class="impact-metric">
                    <div class="metric-icon">
                        <i class="fas fa-weight"></i>
                    </div>
                    <div class="metric-value">
                        <span class="number">{{ "%.1f"|format(stats.total_recycled_weight|default(45.6)) }}</span>
                        <span class="unit">kg</span>
                    </div>
                    <div class="metric-label">Waste Recycled</div>
                    <div class="metric-progress">
                        <div class="eco-progress">
                            <div class="eco-progress-bar" style="width: 82%;"></div>
                        </div>
                    </div>
                </div>

                <div class="impact-metric">
                    <div class="metric-icon">
                        <i class="fas fa-cloud"></i>
                    </div>
                    <div class="metric-value">
                        <span class="number" data-counter="{{ stats.co2_saved|default(67) }}">0</span>
                        <span class="unit">kg</span>
                    </div>
                    <div class="metric-label">COâ‚‚ Reduced</div>
                    <div class="metric-progress">
                        <div class="eco-progress">
                            <div class="eco-progress-bar" style="width: 71%;"></div>
                        </div>
                    </div>
                </div>

                <div class="impact-metric">
                    <div class="metric-icon">
                        <i class="fas fa-tint"></i>
                    </div>
                    <div class="metric-value">
                        <span class="number" data-counter="{{ stats.water_saved|default(892) }}">0</span>
                        <span class="unit">L</span>
                    </div>
                    <div class="metric-label">Water Saved</div>
                    <div class="metric-progress">
                        <div class="eco-progress">
                            <div class="eco-progress-bar" style="width: 55%;"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Section -->
        <div class="settings-section" data-animate="fade-up">
            <h2 class="text-center mb-5">
                <i class="fas fa-cog"></i>
                Settings
            </h2>

            <div class="settings-grid">
                <div class="setting-card eco-card">
                    <div class="setting-header">
                        <div class="setting-icon">
                            <i class="fas fa-globe"></i>
                        </div>
                        <h3>Language Preferences</h3>
                    </div>
                    <div class="setting-content">
                        <p>Choose your preferred language for the best experience</p>
                        <a href="{{ url_for('select_language') }}" class="eco-btn eco-btn-secondary">
                            <i class="fas fa-language"></i>
                            Change Language
                        </a>
                        <small class="current-setting">
                            Current: {% if current_user.preferred_language %}
                                {% set all_langs = get_all_languages() %}
                                {{ all_langs.get(current_user.preferred_language, {}).get('native', 'English') }}
                            {% else %}
                                English
                            {% endif %}
                        </small>
                    </div>
                </div>

                <div class="setting-card eco-card">
                    <div class="setting-header">
                        <div class="setting-icon">
                            <i class="fas fa-bell"></i>
                        </div>
                        <h3>Notifications</h3>
                    </div>
                    <div class="setting-content">
                        <p>Manage your notification preferences</p>
                        <div class="notification-options">
                            <label class="switch">
                                <input type="checkbox" checked>
                                <span class="slider"></span>
                            </label>
                            <span>Email notifications</span>
                        </div>
                        <div class="notification-options">
                            <label class="switch">
                                <input type="checkbox" checked>
                                <span class="slider"></span>
                            </label>
                            <span>Recycling reminders</span>
                        </div>
                        <div class="notification-options">
                            <label class="switch">
                                <input type="checkbox">
                                <span class="slider"></span>
                            </label>
                            <span>Achievement alerts</span>
                        </div>
                    </div>
                </div>

                <div class="setting-card eco-card">
                    <div class="setting-header">
                        <div class="setting-icon">
                            <i class="fas fa-shield-alt"></i>
                        </div>
                        <h3>Privacy</h3>
                    </div>
                    <div class="setting-content">
                        <p>Control your privacy and data settings</p>
                        <button class="eco-btn eco-btn-secondary">
                            <i class="fas fa-lock"></i>
                            Privacy Settings
                        </button>
                    </div>
                </div>

                <div class="setting-card eco-card">
                    <div class="setting-header">
                        <div class="setting-icon">
                            <i class="fas fa-question-circle"></i>
                        </div>
                        <h3>Help & Support</h3>
                    </div>
                    <div class="setting-content">
                        <p>Get help with using ReGenWorks</p>
                        <div class="help-links">
                            <a href="#" class="help-link">
                                <i class="fas fa-book"></i>
                                User Guide
                            </a>
                            <a href="#" class="help-link">
                                <i class="fas fa-envelope"></i>
                                Contact Support
                            </a>
                            <a href="#" class="help-link">
                                <i class="fas fa-comments"></i>
                                FAQ
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="quick-actions-section" data-animate="fade-up">
            <div class="eco-card">
                <h2 class="text-center mb-4">Quick Actions</h2>
                <div class="action-buttons-grid">
                    <a href="{{ url_for('index') }}" class="action-btn">
                        <i class="fas fa-camera"></i>
                        <span>Scan Item</span>
                    </a>
                    <a href="{{ url_for('drop_points') }}" class="action-btn">
                        <i class="fas fa-map-marker-alt"></i>
                        <span>Find Drop Points</span>
                    </a>
                    <a href="{{ url_for('list_item') }}" class="action-btn">
                        <i class="fas fa-plus-circle"></i>
                        <span>List Item</span>
                    </a>
                    <a href="{{ url_for('rewards') }}" class="action-btn">
                        <i class="fas fa-gift"></i>
                        <span>View Rewards</span>
                    </a>
                    <a href="{{ url_for('leaderboards') }}" class="action-btn">
                        <i class="fas fa-trophy"></i>
                        <span>Leaderboards</span>
                    </a>
                    <a href="{{ url_for('auth.logout') }}" class="action-btn logout">
                        <i class="fas fa-sign-out-alt"></i>
                        <span>Logout</span>
                    </a>
                </div>
            </div>
        </div>
    </div>
</section>

{% block extra_js %}
<style>
.profile-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: var(--spacing-xl);
    margin-bottom: var(--spacing-xxl);
}

.profile-main {
    text-align: center;
}

.profile-header {
    margin-bottom: var(--spacing-xl);
}

.profile-avatar {
    font-size: 6rem;
    color: var(--eco-primary);
    margin-bottom: var(--spacing-lg);
    position: relative;
}

.profile-avatar::after {
    content: '';
    position: absolute;
    bottom: 0;
    right: 0;
    width: 24px;
    height: 24px;
    background: var(--eco-gradient-primary);
    border-radius: 50%;
    border: 3px solid white;
}

.profile-info h2 {
    font-size: 2rem;
    color: var(--eco-primary-dark);
    margin-bottom: var(--spacing-xs);
}

.profile-info p {
    color: var(--eco-primary-dark);
    opacity: 0.8;
    margin-bottom: var(--spacing-sm);
}

.member-since {
    display: inline-flex;
    align-items: center;
    gap: var(--spacing-xs);
    padding: 4px 12px;
    background: rgba(107, 203, 119, 0.1);
    color: var(--eco-primary-dark);
    border-radius: var(--radius-full);
    font-size: 0.9rem;
}

.profile-stats-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: var(--spacing-lg);
    margin-bottom: var(--spacing-xl);
}

.stat-box {
    padding: var(--spacing-lg);
    border-radius: var(--radius-md);
    text-align: center;
    transition: all var(--transition-normal);
}

.stat-box:hover {
    transform: translateY(-4px);
}

.stat-box.primary {
    background: linear-gradient(135deg, rgba(107, 203, 119, 0.2), rgba(76, 175, 80, 0.2));
}

.stat-box.warning {
    background: linear-gradient(135deg, rgba(255, 193, 7, 0.2), rgba(255, 152, 0, 0.2));
}

.stat-icon {
    width: 50px;
    height: 50px;
    margin: 0 auto var(--spacing-md);
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--eco-gradient-primary);
    color: white;
    border-radius: 50%;
    font-size: 1.5rem;
}

.stat-box.warning .stat-icon {
    background: linear-gradient(135deg, #FFC107, #FF9800);
}

.stat-value {
    font-size: 2rem;
    font-weight: 800;
    color: var(--eco-primary-dark);
    margin-bottom: var(--spacing-xs);
}

.stat-label {
    font-size: 0.9rem;
    color: var(--eco-primary-dark);
    opacity: 0.7;
}

.profile-actions {
    margin-top: var(--spacing-lg);
}

.badge-level {
    margin-left: var(--spacing-sm);
    padding: 4px 8px;
    background: linear-gradient(135deg, #FFD700, #FFA500);
    color: white;
    border-radius: var(--radius-full);
    font-size: 0.8rem;
    font-weight: 600;
}

.profile-stats h3 {
    color: var(--eco-primary-dark);
    margin-bottom: var(--spacing-lg);
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
}

.stats-list {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-md);
}

.stat-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: var(--spacing-md);
    background: rgba(255, 255, 255, 0.3);
    border-radius: var(--radius-md);
    transition: all var(--transition-normal);
}

.stat-item:hover {
    background: rgba(255, 255, 255, 0.5);
    transform: translateX(8px);
}

.stat-label {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    color: var(--eco-primary-dark);
    font-weight: 500;
}

.stat-number {
    font-weight: 700;
    font-size: 1.2rem;
    color: var(--eco-primary-dark);
}

.stat-number.success {
    color: #4CAF50;
}

.stat-number.warning {
    color: #FF9800;
}

.stat-number.info {
    color: #2196F3;
}

.stat-number.primary {
    color: var(--eco-primary);
}

.impact-showcase {
    padding: var(--spacing-xxl);
    margin-bottom: var(--spacing-xxl);
}

.impact-metrics {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: var(--spacing-xl);
}

.impact-metric {
    text-align: center;
}

.metric-icon {
    width: 60px;
    height: 60px;
    margin: 0 auto var(--spacing-md);
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--eco-gradient-primary);
    color: white;
    border-radius: 50%;
    font-size: 1.5rem;
    animation: pulse 2s ease-in-out infinite;
}

.metric-value {
    font-size: 2rem;
    font-weight: 800;
    color: var(--eco-primary-dark);
    margin-bottom: var(--spacing-sm);
}

.metric-value .unit {
    font-size: 1rem;
    opacity: 0.7;
    margin-left: 4px;
}

.metric-label {
    font-size: 1rem;
    color: var(--eco-primary-dark);
    opacity: 0.8;
    margin-bottom: var(--spacing-md);
}

.metric-progress {
    width: 100%;
    max-width: 150px;
    margin: 0 auto;
}

.settings-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: var(--spacing-xl);
    margin-bottom: var(--spacing-xxl);
}

.setting-card {
    padding: var(--spacing-xl);
    text-align: center;
    transition: all var(--transition-normal);
}

.setting-card:hover {
    transform: translateY(-8px);
}

.setting-header {
    margin-bottom: var(--spacing-lg);
}

.setting-icon {
    width: 60px;
    height: 60px;
    margin: 0 auto var(--spacing-md);
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--eco-gradient-primary);
    color: white;
    border-radius: 50%;
    font-size: 1.5rem;
}

.setting-header h3 {
    color: var(--eco-primary-dark);
    margin: 0;
}

.setting-content p {
    color: var(--eco-primary-dark);
    opacity: 0.8;
    margin-bottom: var(--spacing-lg);
}

.current-setting {
    display: block;
    margin-top: var(--spacing-sm);
    font-size: 0.85rem;
    color: var(--eco-primary-dark);
    opacity: 0.6;
}

.notification-options {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: var(--spacing-sm) 0;
}

/* Toggle Switch */
.switch {
    position: relative;
    display: inline-block;
    width: 50px;
    height: 24px;
}

.switch input {
    opacity: 0;
    width: 0;
    height: 0;
}

.slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #ccc;
    transition: .4s;
    border-radius: 24px;
}

.slider:before {
    position: absolute;
    content: "";
    height: 18px;
    width: 18px;
    left: 3px;
    bottom: 3px;
    background-color: white;
    transition: .4s;
    border-radius: 50%;
}

input:checked + .slider {
    background-color: var(--eco-primary);
}

input:checked + .slider:before {
    transform: translateX(26px);
}

.help-links {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-sm);
    margin-top: var(--spacing-md);
}

.help-link {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    color: var(--eco-primary);
    text-decoration: none;
    padding: var(--spacing-sm);
    border-radius: var(--radius-md);
    transition: all var(--transition-normal);
}

.help-link:hover {
    background: rgba(107, 203, 119, 0.1);
}

.action-buttons-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: var(--spacing-lg);
}

.action-btn {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: var(--spacing-sm);
    padding: var(--spacing-lg);
    background: rgba(255, 255, 255, 0.3);
    color: var(--eco-primary-dark);
    text-decoration: none;
    border-radius: var(--radius-md);
    transition: all var(--transition-normal);
}

.action-btn:hover {
    background: var(--eco-gradient-primary);
    color: white;
    transform: translateY(-4px);
}

.action-btn.logout:hover {
    background: linear-gradient(135deg, #f44336, #d32f2f);
}

.action-btn i {
    font-size: 1.5rem;
}

/* Responsive adjustments */
@media (max-width: 968px) {
    .profile-grid {
        grid-template-columns: 1fr;
    }

    .impact-metrics {
        grid-template-columns: repeat(2, 1fr);
    }

    .action-buttons-grid {
        grid-template-columns: repeat(2, 1fr);
    }
}

@media (max-width: 480px) {
    .profile-stats-grid {
        grid-template-columns: 1fr;
    }

    .impact-metrics {
        grid-template-columns: 1fr;
    }

    .settings-grid {
        grid-template-columns: 1fr;
    }

    .action-buttons-grid {
        grid-template-columns: 1fr;
    }

    .profile-avatar {
        font-size: 4rem;
    }

    .profile-info h2 {
        font-size: 1.5rem;
    }
}
</style>

<script>
// Animate numbers on scroll
document.addEventListener('DOMContentLoaded', function() {
    const observerOptions = {
        threshold: 0.5,
        rootMargin: '0px'
    };

    const numberObserver = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                const target = entry.target;
                const finalValue = parseInt(target.dataset.counter) || parseFloat(target.textContent);
                let currentValue = 0;
                const increment = finalValue / 50;

                const timer = setInterval(() => {
                    currentValue += increment;
                    if (currentValue >= finalValue) {
                        currentValue = finalValue;
                        clearInterval(timer);
                    }

                    target.textContent = Math.floor(currentValue).toLocaleString();
                }, 30);

                observer.unobserve(target);
            }
        });
    }, observerOptions);

    // Observe all counter elements
    document.querySelectorAll('[data-counter]').forEach(el => {
        numberObserver.observe(el);
    });
});

// Settings interactions
document.querySelectorAll('.notification-options input').forEach(input => {
    input.addEventListener('change', function() {
        // In a real app, this would save the preference
        console.log('Notification setting changed:', this.checked);
    });
});
</script>
{% endblock %}
{% endblock %}